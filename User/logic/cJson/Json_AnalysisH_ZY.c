/*
*********************************************************************************************************
*	                                            V4
*                           Commuication Controller For The Mining Industry
*
*                                  (c) Copyright 1994-2013  HNDZ 
*                       All rights reserved.  Protected by international copyright laws.
*
*
*    File    : Can_Bus.c
*    Module  : user
*    Version : V1.0
*    History :
*   -----------------
*              Version  Date           By            Note
*              v1.0         
*
*********************************************************************************************************
*/
#include "includes.h"
#include "Json_Analysis.h"
#include "cJSON.h"
#include "DoFatfsFiles.h"
#include "sys_msg_def.h"

#define jsonParaQueueSize 1024
#define jsonNameSize  40
uint8_t jsonParaQueue[jsonParaQueueSize] = {0};
char  jsonName[jsonNameSize];

const char *ssss;

///*
const char V4paraall[] = {"{\"V4参数":\
	[\
		{\"系统参数\":\
			[\
				{\"本架参数\":\
					[\
						[\"本架编号\",0,250,1,3,1,2,2,6,0],\
						[\"架号增向\",16,1,0,1,1,1,2,1,0],\
						[\"最小架号\",0,250,1,1,1,2,2,1,0],\
						[\"最大架号\",0,250,1,1,1,2,2,250,0],\
						[\"停止范围\",0,100,0,1,1,2,2,1,0],\
						[\"隔架架数\",0,5,0,1,1,2,2,5,0],\
						[\"服务器使能\",1,1,0,1,1,1,2,1,0],\
						[\"主控时间\",0,180,1,1,1,2,2,30,1],\
						[\"支架类型\",24,2,0,1,1,1,2,0,0]\
					]\
				},\
				{\"服务参数\":\
					[\
						[\"复位控制器\",    23,1,0,4,1,100,2,0,0],\
						[\"复位服务器\",    23,1,0,4,1,101,1,0,0],\
						[\"传送接口表\",    17,2,0,4,1,102,1,0,0],\
						[\"传感器接口表\",  17,2,0,4,1,103,1,0,0],\
						[\"传辅助动作\",    17,2,0,4,1,104,1,0,0],\
						[\"传键盘配置\",    17,2,0,4,1,105,1,0,0],\
						[\"传送全局参数\",  17,2,0,4,1,106,2,0,0],\
						[\"传送所有参数\",  17,2,0,4,1,107,2,0,0],\
						[\"恢复出厂设置\",  23,1,0,4,1,108,2,0,0],\
						[\"保存参数\",      23,1,0,4,1,109,1,0,0],\
						[\"恢复参数\",      23,1,0,4,1,110,1,0,0]\
					]\
				},\
				{\"键盘配置\":\
					[\
						[\"2键-1\",241,60,0,3,1,1,2,1,0],\
						[\"2键-2\",241,60,0,3,1,1,2,0,0],\
						[\"3键-1\",241,60,0,3,1,1,2,2,0],\
						[\"3键-2\",241,60,0,3,1,1,2,0,0],\
						[\"5键-1\",241,60,0,3,1,1,2,3,0],\
						[\"5键-2\",241,60,0,3,1,1,2,0,0],\
						[\"6键-1\",241,60,0,3,1,1,2,4,0],\
						[\"6键-2\",241,60,0,3,1,1,2,0,0],\
						[\"8键-1\",241,60,0,3,1,1,2,5,0],\
						[\"8键-2\",241,60,0,3,1,1,2,0,0],\
						[\"9键-1\",241,60,0,3,1,1,2,6,0],\
						[\"9键-2\",241,60,0,3,1,1,2,0,0]\
					]\
				},\
				{\"辅助动作\":\
					[\
						[\"1-L1\",240,60,0,3,1,1,2,7,0],\
						[\"1-R1\",240,60,0,3,1,1,2,8,0],\
						[\"1-L2\",240,60,0,3,1,1,2,9,0],\
						[\"1-R2\",240,60,0,3,1,1,2,10,0],\
						[\"1-L3\",240,60,0,3,1,1,2,11,0],\
						[\"1-R3\",240,60,0,3,1,1,2,12,0],\
						[\"2-L1\",240,60,0,3,1,1,2,13,0],\
						[\"2-R1\",240,60,0,3,1,1,2,14,0],\
						[\"2-L2\",240,60,0,3,1,1,2,15,0],\
						[\"2-R2\",240,60,0,3,1,1,2,16,0],\
						[\"2-L3\",240,60,0,3,1,1,2,0,0],\
						[\"2-R3\",240,60,0,3,1,1,2,0,0],\
						[\"3-L1\",240,60,0,3,1,1,2,0,0],\
						[\"3-R1\",240,60,0,3,1,1,2,0,0],\
						[\"3-L2\",240,60,0,3,1,1,2,0,0],\
						[\"3-R2\",240,60,0,3,1,1,2,0,0],\
						[\"3-L3\",240,60,0,3,1,1,2,0,0],\
						[\"3-R3\",240,60,0,3,1,1,2,0,0],\
						[\"4-L1\",240,60,0,3,1,1,2,0,0],\
						[\"4-R1\",240,60,0,3,1,1,2,0,0],\
						[\"4-L2\",240,60,0,3,1,1,2,0,0],\
						[\"4-R2\",240,60,0,3,1,1,2,0,0],\
						[\"4-L3\",240,60,0,3,1,1,2,0,0],\
						[\"4-R3\",240,60,0,3,1,1,2,0,0],\
						[\"5-L1\",240,60,0,3,1,1,2,0,0],\
						[\"5-R1\",240,60,0,3,1,1,2,0,0],\
						[\"5-L2\",240,60,0,3,1,1,2,0,0],\
						[\"5-R2\",240,60,0,3,1,1,2,0,0],\
						[\"5-L3\",240,60,0,3,1,1,2,0,0],\
						[\"5-R3\",240,60,0,3,1,1,2,0,0]\
					]\
				},\
				{\"主界面\":\
					[\
						[\"显示项1\",242,32,0,3,1,1,2,0,0],\
						[\"显示项2\",242,32,0,3,1,1,2,0,0],\
						[\"显示项3\",242,32,0,3,1,1,2,0,0],\
						[\"显示项4\",242,32,0,3,1,1,2,0,0],\
						[\"显示项5\",242,32,0,3,1,1,2,0,0],\
						[\"显示项6\",242,32,0,3,1,1,2,0,0]\
					]\
				},\
				{\"声光报警\":\
					[\
						[\"声光报警使能\",1,1,0,3,1,1,2,1,0]\
					]\
				},\
				{\"人员定位\":\
					[\
						[\"人员定位使能\",1,1,0,3,1,1,2,0,0],\
						[\"人员闭锁使能\",1,1,0,3,1,1,2,0,0],\
						[\"闭锁距离\",0,1500,20,1,1,2,2,150,4],\
						[\"解锁差值\",0,1500,20,1,1,2,2,20,4],\
						[\"闭锁时间\",0,300,0,1,1,3,2,200,1],\
						[\"检测距离\",0,1500,20,1,1,2,2,500,4],\
						[\"上报间隔\",0,255,1,1,1,3,2,10,1],\
						[\"发送功率\",18,11,0,1,1,1,2,11,5],\
						[\"闭锁动作ID1\",0,10,1,1,1,2,1,1,0],\
						[\"闭锁动作ID2\",0,10,1,1,1,2,1,2,0]\
					]\
				},\
				{\"红外接收\":\
					[\
						[\"红外模块接收\",1,1,0,3,1,1,2,0,0],\
						[\"红外对码接收\",1,1,0,3,1,1,2,1,0]\
					]\
				},\
				{\"无线总线\":\
					[\
						[\"无线总线使能\",1,1,0,3,1,1,2,0,0]\
					]\
				}\
			]\
		},\
		{\"单动作\":\
			[\
				{\"右前升\":\
					[\
						{\"动作参数\":\
							[\
								[\"右前升\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,1,0],\
								[\"驱动号\",6,3,1,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,1,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",2,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,0,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,0,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,2,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"右前降\":\
					[\
						{\"动作参数\":\
							[\
								[\"右前降\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,2,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,2,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,100,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,0,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,1,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"右后升\":\
					[\
						{\"动作参数\":\
							[\
								[\"右后升\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,3,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,3,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,200,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,1,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,4,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"右后降\":\
					[\
						{\"动作参数\":\
							[\
								[\"右后降\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,4,0],\
								[\"驱动号\",6,3,1,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,4,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",2,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,0,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,0,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,3,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"前移\":\
					[\
						{\"动作参数\":\
							[\
								[\"前移\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,5,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,5,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,0,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,0,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,6,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"后退\":\
					[\
						{\"动作参数\":\
							[\
								[\"后退\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,6,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,6,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,0,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,0,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,5,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"左前升\":\
					[\
						{\"动作参数\":\
							[\
								[\"左前升\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,7,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,7,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,60,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,0,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,8,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"左前降\":\
					[\
						{\"动作参数\":\
							[\
								[\"左前降\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,8,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,8,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,60,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,0,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,7,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"左后升\":\
					[\
						{\"动作参数\":\
							[\
								[\"左后升\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,9,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,9,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,20,1],\
								[\"执行时间\",0,255,0,1,1,3,2,80,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,1,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,10,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"左后降\":\
					[\
						{\"动作参数\":\
							[\
								[\"左后降\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,10,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,10,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,0,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,0,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,9,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"前架升\":\
					[\
						{\"动作参数\":\
							[\
								[\"前架升\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,11,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,11,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,60,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,0,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,12,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"前架降\":\
					[\
						{\"动作参数\":\
							[\
								[\"前架降\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,12,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,12,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,60,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,0,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,11,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"前左摆\":\
					[\
						{\"动作参数\":\
							[\
								[\"前左摆\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,13,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,13,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,200,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,1,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,14,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"前右摆\":\
					[\
						{\"动作参数\":\
							[\
								[\"前右摆\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,14,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,14,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,200,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,1,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,13,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"后左摆\":\
					[\
						{\"动作参数\":\
							[\
								[\"后左摆\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,15,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,15,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,200,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,1,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,16,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				},\
				{\"后右摆\":\
					[\
						{\"动作参数\":\
							[\
								[\"后右摆\",0,0,0,0,0,0,3,0,0],\
								[\"动作ID\",0,40,1,0,0,0,4,16,0],\
								[\"驱动号\",6,3,0,3,1,1,1,2,0],\
								[\"设备号\",7,6,0,3,1,1,1,1,0],\
								[\"子设备号\",0,2,1,3,1,2,1,1,0],\
								[\"点号\",0,32,1,3,1,2,2,16,0],\
								[\"是否使能\",1,1,0,3,1,1,2,1,0],\
								[\"报警类型\",2,4,0,1,1,1,1,1,0],\
								[\"声报警方式\",14,4,0,1,1,1,1,3,0],\
								[\"光报警方式\",15,5,0,1,1,1,1,1,0],\
								[\"预警时间\",0,255,0,1,1,3,1,0,1],\
								[\"延时时间\",0,255,0,1,1,3,2,0,1],\
								[\"执行时间\",0,255,0,1,1,3,2,200,1],\
								[\"控制方式\",21,2,0,1,1,1,1,0,0],\
								[\"本架控制方式\",22,1,0,1,1,1,1,1,0],\
								[\"禁止动作1\",0,40,0,1,1,2,1,15,0],\
								[\"禁止动作2\",0,40,0,1,1,2,1,0,0]\
							]\
						}\
					]\
				}\				
			]\
		}\
	]\
}"};
//*/
uint8_t jsonDataQueue[85000] __attribute__((at(MEM_SDRAM_CJSON_POS)));//测试用数组
STR_V4PARA_NAME childName[40];
static uint32_t writept = 0;
static cJSON  *v4Json = NULL;



void setParaDataProc(uint8_t * data,uint8_t len)
{
	
	if(writept<(85000-1))
	{
		memcpy(jsonDataQueue+writept,data,len);
	}
	writept += len;
}



/* 计算存入数据的地址位置*/
uint32_t getParaAddress(void)
{
	return writept;
}

/*******************************************************************************************
**函数名称：getComAPI
**函数作用：获取参数公共函数
**函数参数：无
**函数输出：无
**注意事项：无
*******************************************************************************************/
cJSON* getComAPI(uint64_t levels)
{
	uint8_t i = 0,j = 0,leveltmp = 0;
	cJSON *tmp = v4Json;
	if(levels == 0)
		return NULL;
	
	for(j = 0; j < 5; j++)
	{
		//计算目录
		leveltmp = ((levels>>((7-j)*8))&0xff);
		if(leveltmp == 0)
			break;
		if(!tmp->child)
			return NULL;
		
		tmp = tmp->child;
		if(tmp->type == cJSON_Array)//跳过array的cjson结构体
		{
			if(!tmp->child) 
				return NULL;
			tmp = tmp->child;
		}
		//遍历对应次数
		for(i = 1; i<leveltmp; i++)
		{
			if(!tmp->next)
				return NULL;
			tmp = tmp->next;
		}
	}
	return tmp;
}


/*******************************************************************************************
**函数名称：getJsonParaAddress
**函数作用：获取参数的对应地址
**函数参数：无
**函数输出：无
**注意事项：无
*******************************************************************************************/
uint8_t* getJsonParaAddress(uint64_t levels)
{
	cJSON *tmp  = NULL;
	uint32_t leveladdress = 0;
	
	tmp = getComAPI(levels);
	if(tmp == NULL)
		return NULL;
	leveladdress = tmp->valueint;
	
	return (jsonDataQueue+leveladdress);
}


/*******************************************************************************************
**函数名称：getJsonMenuName
**函数作用：获取参数的对应menu名称
**函数参数：无
**函数输出：无
**注意事项：无
*******************************************************************************************/
uint8_t getJsonMenuName(uint64_t levels,char ** name)
{
	uint8_t res = 0;
	static char *menuName;
	cJSON *tmp  = NULL;
	tmp = getComAPI(levels);
	if(tmp == NULL)
		return res;
	
	menuName = tmp->child->name;
	*name = menuName;
	res = 1;
	return res;
}



/*******************************************************************************************
**函数名称：getJsonParaChildSize
**函数作用：获取参数在最底层的child个数
**函数参数：无
**函数输出：无
**注意事项：无
*******************************************************************************************/
uint8_t getJsonParaChildSize(uint64_t levels)
{
	cJSON *tmp = NULL;
	uint8_t childSize = 0;
	
	tmp = getComAPI(levels);
	if(tmp == NULL)
		return 0;
	while(tmp->type != cJSON_String)
	{
		if(!tmp->child)
			return 0;
		tmp = tmp->child;
	}
	childSize = tmp->childSize;
	
	return childSize;
}

/*******************************************************************************************
**函数名称：getJsonParaChildSize
**函数作用：返回正确的级数
**函数参数：无
**函数输出：无
**注意事项：无
*******************************************************************************************/
uint8_t ModifyTheLevel(uint64_t levels,uint8_t* sent)
{
	cJSON *tmp = NULL;
	uint64_t id = 0;
	uint8_t childSize = 0;
	uint8_t i = 0;
	uint8_t temp[8];
	if(levels == 0)
	{
		levels = 0x100000000000000;
	}
	tmp = getComAPI(levels);
	if(tmp == NULL)
		return 0;
	memset(temp,0,8);
	
	temp[0] = (uint8_t)(levels >> 56);
	temp[1] = (uint8_t)(levels >> 48);
	temp[2] = (uint8_t)(levels >> 40);
	temp[3] = (uint8_t)(levels >> 32);
	temp[4] = (uint8_t)(levels >> 24);
	temp[5] = (uint8_t)(levels >> 16);
	temp[6] = (uint8_t)(levels >> 8);
	temp[7] = (uint8_t)(levels );
	
	while(tmp->type != cJSON_String)
	{
		if(!tmp->child)
			return 0;
		tmp = tmp->child;
		if(tmp->type == cJSON_Array)
		{
			for(i=0;i<8;i++)
			{
				if(temp[i] == 0)
				{
					temp[i] = 0x01;
					break;
				}
			}
		}
		
	}	
	id |= ((uint64_t)temp[7]);
	id |= ((uint64_t)temp[6] <<8);
	id |= ((uint64_t)temp[5] <<16);
	id |= ((uint64_t)temp[4] <<24);
	id |= ((uint64_t)temp[3] <<32);
	id |= ((uint64_t)temp[2] <<40);
	id |= ((uint64_t)temp[1] <<48);
	id |= ((uint64_t)temp[0] <<56);
		
	
	memcpy(sent,(u8 *)&id,8);
}
/*******************************************************************************************
**函数名称：getJsonParaIsChilds
**函数作用：获取参数有没有孩子
**函数参数：无
**函数输出：无
**注意事项：无
*******************************************************************************************/
uint8_t getJsonParaIsChilds(uint64_t levels)
{
	cJSON *tmp = NULL;	
	tmp = getComAPI(levels);
	if(tmp == NULL)
		return 0;
	
	if(!tmp->child)
		return 0;
	
	if(tmp->child->type == cJSON_String)
		return 0;
	else 
		return 1;
}

/*******************************************************************************************
**函数名称：getJsonParaStruct
**函数作用：获取参数指定结构体
**函数参数：无
**函数输出：无
**注意事项：无
*******************************************************************************************/
uint8_t getJsonParaStruct(uint64_t levels,STR_V4PARA_NAME** childname)
{
	uint8_t i = 0,res = 0;
	cJSON *tmp = NULL;	
	tmp = getComAPI(levels);
	
	tmp = tmp->child;
	if(tmp->type == cJSON_Array)//跳过array的cjson结构体
	{
		if(!tmp->child) 
			return NULL;
		tmp = tmp->child;
	}
		
	memset(childName,0,sizeof(childName));
	
	if(tmp == NULL)
		return 0;
	
	if(!tmp->child)
		return 0;
	if(tmp->type == cJSON_Object&& tmp->child!= NULL)
	{
		memcpy(&childName[0],tmp->child->name,sizeof(STR_V4PARA_NAME));
		res++;
	}
	for(i = 1; i<40; i++)
	{
		if(tmp->type == cJSON_Object&& tmp->child!= NULL && tmp->next!= NULL)
		{
			tmp = tmp->next;
			memcpy(&childName[i],tmp->child->name,sizeof(STR_V4PARA_NAME));
			res++;
		}
		else
			break;
		
	}	
	*childname = childName;
	return res;
}

uint8_t getJsonParaStructSize(uint64_t levels)
{
	uint8_t i = 0,res = 0;
	cJSON *tmp = NULL;	
	tmp = getComAPI(levels);

	tmp = tmp->child;
	if(tmp->type == cJSON_Array)//跳过array的cjson结构体
	{
		if(!tmp->child) 
			return NULL;
		tmp = tmp->child;
	}
	
	if(tmp == NULL)
		return 0;
	
	if(!tmp->child)
		return 0;
	if(tmp->type == cJSON_Object&& tmp->child!= NULL)
	{
		res++;
	}
	for(i = 1; i<40; i++)
	{
		if(tmp->type == cJSON_Object&& tmp->child!= NULL && tmp->next!= NULL)
		{
			tmp = tmp->next;
			res++;
		}
		else
			break;
		
	}	
	return res;
}

/*******************************************************************************************
**函数名称：getParaBufferAddress
**函数作用：获取参数读取缓存的最后一个指针
**函数参数：无
**函数输出：无
**注意事项：无
*******************************************************************************************/
uint8_t* getParaBufferAddress()
{
	return jsonParaQueue+jsonParaQueueSize-1;
}


/*******************************************************************************************
**函数名称：setParaBufferAddress
**函数作用：读取json文件并返回头指针
**函数参数：无
**函数输出：无
**注意事项：无
*******************************************************************************************/
uint8_t* setParaBufferAddress()
{
	Fatfs_readFile(jsonName,jsonParaQueue,jsonParaQueueSize);
	return jsonParaQueue;
}

/*******************************************************************************************
**函数名称：getJsonVersion
**函数作用：获取json的版本号
**函数参数：无
**函数输出：无
**注意事项：无
*******************************************************************************************/
uint8_t* getJsonVersion()
{
	cJSON *tmp = v4Json;
	return (uint8_t*)tmp->child->name;
}



void saveJsonToFatfs(void)
{
//	Fatfs_CreateDir("update");
	DeleteDirFile("0:/update/可编程_V0001.txt");	
	Fatfs_createFile("0:/update/可编程_V0001.txt");
	Fatfs_openFile("0:/update/可编程_V0001.txt");
	Fatfs_writeFile((uint8_t *)V4paraall,sizeof(V4paraall));
	Fatfs_closeFile();
//	ee_WriteBytes("0:/update/可编程_V0001.txt", JSON_PARAM_USING_START, 30);
//	AnalysisJsonProc("0:/update/可编程_V0001.txt");
}


/*******************************************************************************************
**函数名称：AnalysisJsonProc
**函数作用：解析json函数
**函数参数：无
**函数输出：无
**注意事项：无
*******************************************************************************************/
uint8_t AnalysisJsonProc(char * name)
{
	uint32_t i = 0;
	
	for(i = 0; i<jsonNameSize; i++)
	{
		jsonName[i] = *(name+i);
		if((name+i) == '\0')
		{
			break;
		}
	}
	
	i = Fatfs_openFile(jsonName,0);
	if(i == 0)
	{
		Fatfs_closeFile();
		return 0;
	}
	Fatfs_readFile(jsonName,jsonParaQueue,jsonParaQueueSize);
	
	v4Json=cJSON_Parse(jsonParaQueue);//(jsonParaQueue); //底层解析
	Fatfs_closeFile();
	ssss = cJSON_GetErrorPtr();
	
	if(ssss == NULL)
		return 1;//success
	else
		return 0;//fault	
}


/*******************************************************************************************
**函数名称：AnalysisJsonProc
**函数作用：解析json函数
**函数参数：无
**函数输出：无
**注意事项：无
*******************************************************************************************/
uint8_t AnalysisInsideJsonProc(void)
{
		
	v4Json=cJSON_Parse(V4paraall);//底层解析
	ssss = cJSON_GetErrorPtr();
	
	if(ssss == NULL)
		return 1;//success
	else
		return 0;//fault	
}
















